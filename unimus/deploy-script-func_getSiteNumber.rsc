/system script remove func_getSiteNumber;
/system script add name="func_getSiteNumber" policy=read comment="Function: func_getSiteNumber" source=":local routeID [/ip route find dst-address=0.0.0.0/0];\n:local gateway [:tostr ([/ip route get \$routeID value-name=gateway])];\n:local lookup { \"firstDivider\"=[:find \$gateway \".\"] ; \"secondOctet\"=\"\" ; \"octetLength\"=0 ; \"nextDivider\"=0 ; \"findResult\"=\"\" };\n:set (\$lookup->\"secondOctet\") [:pick \$gateway ((\$lookup->\"firstDivider\") + 1) ((\$lookup->\"firstDivider\") + 4)];\n:set (\$lookup->\"findResult\") [:find (\$lookup->\"secondOctet\") \".\"];\n:while ([:typeof (\$lookup->\"findResult\")] = \"num\") do={\n:set (\$lookup->\"octetLength\") [:len (\$lookup->\"secondOctet\")];\n:set (\$lookup->\"nextDivider\") [:find (\$lookup->\"secondOctet\") \".\"];\n:set (\$lookup->\"secondOctet\") [:pick (\$lookup->\"secondOctet\") 0 (\$lookup->\"nextDivider\")];\n:set (\$lookup->\"findResult\") [:find (\$lookup->\"secondOctet\") \".\"];\n};\nreturn (\$lookup->\"secondOctet\");\n"
